generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model ApiKey {
  id        String   @id @default(cuid())
  key       String
  name      String   @unique
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("api_keys")
}

model User {
  id                    String                @id @default(cuid())
  name                  String?
  email                 String?               @unique
  emailVerified         DateTime?
  image                 String?
  password              String?
  passwordResetToken    String?               @unique
  passwordResetTokenExp DateTime?
  role                  UserRole              @default(CUSTOMER)
  phone                 String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  avatarMediaId         String?
  avatarPath            String?
  coverImage            String?
  birthDate             String?
  activationCode        String?
  activationCodeExp     DateTime?
  accounts              Account[]
  addresses             Address[]
  apiKeys               ApiKey[]
  cart                  Cart?
  orders                Order[]
  reviews               Review[]
  sessions              Session[]
  wishlist              Wishlist?
  cancellationRequests  CancellationRequest[]
  returnRequests        ReturnRequest[]

  @@map("users")
}

model Category {
  id               String            @id @default(cuid())
  name             String
  slug             String            @unique
  description      String?
  image            String?
  parentId         String?
  icon             String?
  order            Int               @default(0)
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  themeColor       String?
  bundleCategories BundleCategory[]
  parent           Category?         @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children         Category[]        @relation("CategoryHierarchy")
  categoryFeatures CategoryFeature[]
  filters          Filter[]          @relation("CategoryFilters")
  products         Product[]

  @@map("categories")
}

model Brand {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  logoUrl     String?
  website     String?
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  bundles     Bundle[]
  products    Product[]

  @@index([isActive])
  @@index([slug])
  @@map("brands")
}

model Product {
  id                   String                @id @default(cuid())
  name                 String
  slug                 String                @unique
  description          String?
  shortDescription     String?
  price                Decimal               @db.Decimal(10, 2)
  comparePrice         Decimal?              @db.Decimal(10, 2)
  costPrice            Decimal?              @db.Decimal(10, 2)
  sku                  String?               @unique
  barcode              String?
  stock                Int                   @default(0)
  lowStockAlert        Int                   @default(5)
  images               String[]
  thumbnail            String?
  brand                String?
  weight               Decimal?              @db.Decimal(10, 2)
  dimensions           String?
  metaTitle            String?
  metaDescription      String?
  metaKeywords         String[]
  isActive             Boolean               @default(true)
  isFeatured           Boolean               @default(false)
  isNew                Boolean               @default(false)
  freeShipping         Boolean               @default(false)
  shippingClass        String?
  productType          ProductType           @default(SIMPLE)
  publishedAt          DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  categoryId           String
  saleEndDate          DateTime?
  videoUrl             String?
  shippingClassId      String?
  brandId              String?
  bundleItems          BundleItem[]
  cartItems            CartItem[]
  keyFeatures          KeyFeature[]
  orderItems           OrderItem[]
  productAttributes    ProductAttribute[]
  productBadges        ProductBadge[]
  productFeatureValues ProductFeatureValue[]
  variants             ProductVariant[]
  brandRef             Brand?                @relation(fields: [brandId], references: [id])
  category             Category              @relation(fields: [categoryId], references: [id])
  shippingClassRef     ShippingClass?        @relation("ProductShippingClass", fields: [shippingClassId], references: [id])
  relatedFrom          RelatedProduct[]      @relation("RelatedFrom")
  relatedTo            RelatedProduct[]      @relation("RelatedTo")
  reviews              Review[]
  technicalSpecs       TechnicalSpec[]
  wishlistItems        WishlistItem[]

  @@map("products")
}

model ProductVariant {
  id             String                 @id @default(cuid())
  productId      String
  name           String?
  type           String?
  value          String?
  sku            String?                @unique
  price          Decimal?               @db.Decimal(10, 2)
  stock          Int                    @default(0)
  image          String?
  isActive       Boolean                @default(true)
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  barcode        String?
  colorCode      String?
  combinationKey String?
  salePrice      Decimal?               @db.Decimal(10, 2)
  weight         Decimal?               @db.Decimal(10, 2)
  variantOptions ProductVariantOption[]
  product        Product                @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_variants")
}

model ProductVariantOption {
  id               String         @id @default(cuid())
  variantId        String
  attributeId      String
  attributeValueId String
  createdAt        DateTime       @default(now())
  attribute        Attribute      @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  attributeValue   AttributeValue @relation(fields: [attributeValueId], references: [id], onDelete: Cascade)
  variant          ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([variantId, attributeId])
  @@map("product_variant_options")
}

model KeyFeature {
  id        String   @id @default(cuid())
  productId String
  title     String
  icon      String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("key_features")
}

model TechnicalSpec {
  id        String   @id @default(cuid())
  productId String
  label     String
  value     String
  group     String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("technical_specs")
}

model Attribute {
  id                String                 @id @default(cuid())
  name              String                 @unique
  slug              String                 @unique
  type              AttributeType          @default(SELECT)
  displayType       AttributeDisplay       @default(DROPDOWN)
  showInFilters     Boolean                @default(true)
  showInProductPage Boolean                @default(true)
  order             Int                    @default(0)
  isActive          Boolean                @default(true)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  isVariation       Boolean                @default(false)
  values            AttributeValue[]
  filters           Filter[]               @relation("FilterAttribute")
  productAttributes ProductAttribute[]
  variantOptions    ProductVariantOption[]

  @@map("attributes")
}

model AttributeValue {
  id                String                 @id @default(cuid())
  attributeId       String
  name              String
  slug              String
  value             String?
  color             String?
  image             String?
  order             Int                    @default(0)
  isActive          Boolean                @default(true)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  attribute         Attribute              @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  productAttributes ProductAttribute[]
  variantOptions    ProductVariantOption[]

  @@unique([attributeId, slug])
  @@map("attribute_values")
}

model ProductAttribute {
  id               String         @id @default(cuid())
  productId        String
  attributeId      String
  attributeValueId String
  createdAt        DateTime       @default(now())
  attribute        Attribute      @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  attributeValue   AttributeValue @relation(fields: [attributeValueId], references: [id], onDelete: Cascade)
  product          Product        @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, attributeId, attributeValueId])
  @@map("product_attributes")
}

model Badge {
  id            String         @id @default(cuid())
  label         String
  slug          String         @unique
  color         String
  bgColor       String
  icon          String?
  priority      Int            @default(0)
  isActive      Boolean        @default(true)
  autoApply     Boolean        @default(false)
  autoApplyRule String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  bundleBadges  BundleBadge[]
  productBadges ProductBadge[]

  @@map("badges")
}

model ProductBadge {
  id        String   @id @default(cuid())
  productId String
  badgeId   String
  position  Int      @default(0)
  createdAt DateTime @default(now())
  badge     Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, badgeId])
  @@index([productId])
  @@index([badgeId])
  @@map("product_badges")
}

model BundleBadge {
  id        String   @id @default(cuid())
  bundleId  String
  badgeId   String
  position  Int      @default(0)
  createdAt DateTime @default(now())
  badge     Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  bundle    Bundle   @relation(fields: [bundleId], references: [id], onDelete: Cascade)

  @@unique([bundleId, badgeId])
  @@index([bundleId])
  @@index([badgeId])
  @@map("bundle_badges")
}

model Review {
  id           String    @id @default(cuid())
  productId    String?   // Ürün yorumu için (opsiyonel - bundle veya product olabilir)
  bundleId     String?   // Bundle yorumu için (opsiyonel)
  userId       String
  rating       Int
  title        String?
  comment      String
  images       String[]
  displayName  String?   // Kullanıcının tercih ettiği görünen isim (maskeli veya tam)
  isVerified   Boolean   @default(false)
  isApproved   Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  adminReply   String?
  adminReplyAt DateTime?
  product      Product?  @relation(fields: [productId], references: [id], onDelete: Cascade)
  bundle       Bundle?   @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([bundleId])
  @@index([userId])
  @@index([isApproved])
  @@map("reviews")
}

model RelatedProduct {
  id               String       @id @default(cuid())
  productId        String
  relatedProductId String
  relationType     RelationType
  isAutoGenerated  Boolean      @default(true)
  priority         Int          @default(0)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  product          Product      @relation("RelatedFrom", fields: [productId], references: [id], onDelete: Cascade)
  relatedProduct   Product      @relation("RelatedTo", fields: [relatedProductId], references: [id], onDelete: Cascade)

  @@unique([productId, relatedProductId, relationType])
  @@map("related_products")
}

model Order {
  id                        String               @id @default(cuid())
  orderNumber               String               @unique
  userId                    String
  subtotal                  Decimal              @db.Decimal(10, 2)
  shippingCost              Decimal              @default(0) @db.Decimal(10, 2)
  tax                       Decimal              @default(0) @db.Decimal(10, 2)
  discount                  Decimal              @default(0) @db.Decimal(10, 2)
  total                     Decimal              @db.Decimal(10, 2)
  status                    OrderStatus          @default(PENDING)
  paymentStatus             PaymentStatus        @default(PENDING)
  paymentMethod             String?
  shippingAddressId         String?
  billingAddressId          String?
  trackingNumber            String?
  carrierName               String?
  customerNote              String?
  adminNote                 String?
  paidAt                    DateTime?
  shippedAt                 DateTime?
  deliveredAt               DateTime?
  cancelledAt               DateTime?
  createdAt                 DateTime             @default(now())
  updatedAt                 DateTime             @updatedAt
  couponCode                String?
  couponId                  String?
  confirmedAt               DateTime?
  invoiceUploadedAt         DateTime?
  invoiceUrl                String?
  preparingAt               DateTime?
  refundedAt                DateTime?
  statusHistory             Json?                @db.Json
  iyzicoConversationId      String?
  iyzicoPaymentId           String?
  iyzicoPaymentTransactions Json?                @db.Json
  reviewReminderSent        Boolean              @default(false)
  contractAccessToken       String?              @unique
  items                     OrderItem[]
  billingAddress            Address?             @relation("BillingAddress", fields: [billingAddressId], references: [id])
  coupon                    Coupon?              @relation(fields: [couponId], references: [id])
  shippingAddress           Address?             @relation("ShippingAddress", fields: [shippingAddressId], references: [id])
  user                      User                 @relation(fields: [userId], references: [id])
  cancellationRequest       CancellationRequest?
  returnRequests            ReturnRequest[]

  @@map("orders")
}

model OrderItem {
  id          String   @id @default(cuid())
  orderId     String
  productId   String
  quantity    Int
  price       Decimal  @db.Decimal(10, 2)
  subtotal    Decimal  @db.Decimal(10, 2)
  variantInfo String?
  createdAt   DateTime @default(now())
  bundleId    String?
  bundle      Bundle?  @relation(fields: [bundleId], references: [id])
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id])

  @@map("order_items")
}

// ═══════════════════════════════════════════════════════════════════════════
// CANCELLATION & RETURN REQUEST MODELS
// ═══════════════════════════════════════════════════════════════════════════

model CancellationRequest {
  id          String        @id @default(cuid())
  orderId     String        @unique
  order       Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  status      RequestStatus @default(PENDING_ADMIN_APPROVAL)
  requestIp   String?
  reason      String?
  adminNote   String?
  reviewedBy  String?
  reviewedAt  DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("cancellation_requests")
}

model ReturnRequest {
  id                 String        @id @default(cuid())
  orderId            String
  order              Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  userId             String
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  reason             ReturnReason
  description        String?
  images             String[]      // Kullanıcının yüklediği görseller (max 3)
  status             RequestStatus @default(PENDING_ADMIN_APPROVAL)
  requestIp          String?
  adminNote          String?
  returnAddress      String?       // Admin'in belirlediği iade adresi
  returnInstructions String?       // Admin'in yazdığı iade talimatları
  reviewedBy         String?
  reviewedAt         DateTime?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  @@index([userId])
  @@index([orderId])
  @@index([status])
  @@index([createdAt])
  @@map("return_requests")
}

model IpBan {
  id          String   @id @default(cuid())
  ip          String   @unique
  reason      String?
  banType     BanType  @default(SOFT)
  bannedUntil DateTime
  userId      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([ip])
  @@index([bannedUntil])
  @@map("ip_bans")
}

model RateLimitLog {
  id        String   @id @default(cuid())
  ip        String
  userId    String?
  action    String
  createdAt DateTime @default(now())

  @@index([ip, action, createdAt])
  @@index([userId, action, createdAt])
  @@map("rate_limit_logs")
}

model PaymentDraft {
  id             String    @id @default(cuid())
  order_number   String    @unique
  user_id        String?
  payment_method String
  payload        Json
  created_at     DateTime  @default(now()) @db.Timestamp(6)
  expires_at     DateTime? @db.Timestamp(6)

  @@map("payment_drafts")
}

model Cart {
  id                 String     @id @default(cuid())
  userId             String     @unique
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  lastReminderSentAt DateTime?
  reminderCount      Int        @default(0)
  items              CartItem[]
  user               User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("carts")
}

model CartItem {
  id          String   @id @default(cuid())
  cartId      String
  productId   String
  quantity    Int      @default(1)
  variantInfo String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  bundleId    String?
  bundle      Bundle?  @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  cart        Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId])
  @@map("cart_items")
}

model Wishlist {
  id        String         @id @default(cuid())
  userId    String         @unique
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  items     WishlistItem[]
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("wishlists")
}

model WishlistItem {
  id         String   @id @default(cuid())
  wishlistId String
  productId  String
  createdAt  DateTime @default(now())
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  wishlist   Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)

  @@unique([wishlistId, productId])
  @@map("wishlist_items")
}

model Address {
  id             String      @id @default(cuid())
  userId         String
  firstName      String?
  lastName       String?
  company        String?
  addressLine1   String?
  addressLine2   String?
  city           String
  state          String?
  postalCode     String?
  country        String      @default("TR")
  phone          String
  isDefault      Boolean     @default(false)
  type           AddressType @default(BOTH)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  address        String?
  district       String?
  fullName       String?
  title          String?
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  billingOrders  Order[]     @relation("BillingAddress")
  shippingOrders Order[]     @relation("ShippingAddress")

  @@map("addresses")
}

model Coupon {
  id                 String       @id @default(cuid())
  code               String       @unique
  description        String?
  discountType       DiscountType @default(PERCENTAGE)
  discountValue      Decimal      @db.Decimal(10, 2)
  minOrderAmount     Decimal?     @db.Decimal(10, 2)
  maxDiscount        Decimal?     @db.Decimal(10, 2)
  usageLimit         Int?
  usageCount         Int          @default(0)
  perUserLimit       Int          @default(1)
  startDate          DateTime     @default(now())
  endDate            DateTime?
  isActive           Boolean      @default(true)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  inMysteryBox       Boolean      @default(false)
  allowedCategories  String[]     @default([])
  allowedProducts    String[]     @default([])
  excludeSaleItems   Boolean      @default(false)
  excludedCategories String[]     @default([])
  excludedProducts   String[]     @default([])
  freeShipping       Boolean      @default(false)
  orders             Order[]

  @@map("coupons")
}

model FilterPreset {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  location    String   @default("sidebar")
  showInAll   Boolean  @default(true)
  categoryIds String[]
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  filters     Filter[]

  @@map("filter_presets")
}

model Filter {
  id              String        @id @default(cuid())
  presetId        String?
  name            String
  sourceType      FilterSource  @default(ATTRIBUTE)
  attributeId     String?
  autoPopulate    Boolean       @default(true)
  selectedTermIds String[]
  filterType      FilterType    @default(CHECKBOX)
  displayStyle    FilterDisplay @default(LIST)
  showCount       Boolean       @default(true)
  showHierarchy   HierarchyType @default(FLAT)
  allowMultiple   Boolean       @default(true)
  isCollapsible   Boolean       @default(true)
  isCollapsed     Boolean       @default(false)
  minValue        Decimal?      @db.Decimal(10, 2)
  maxValue        Decimal?      @db.Decimal(10, 2)
  step            Decimal?      @db.Decimal(10, 2)
  order           Int           @default(0)
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  categoryId      String?
  customOptions   Json?
  attribute       Attribute?    @relation("FilterAttribute", fields: [attributeId], references: [id])
  category        Category?     @relation("CategoryFilters", fields: [categoryId], references: [id])
  preset          FilterPreset? @relation(fields: [presetId], references: [id])

  @@map("filters")
}

model Banner {
  id              String          @id @default(cuid())
  name            String
  order           Int             @default(0)
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  backgroundColor String?
  buttonLink      String?
  buttonText      String?
  description     String?
  desktopImage    String?
  gradientFrom    String?
  gradientTo      String?
  mobileImage     String?
  subtitle        String?
  title           String?
  bannerType      BannerType      @default(SINGLE)
  placement       BannerPlacement @default(HOME_CATEGORY)
  cards           BannerCard[]

  @@map("banners")
}

model BannerCard {
  id             String   @id @default(cuid())
  bannerId       String
  title          String
  subtitle       String?
  badge          String?
  buttonText     String?  @default("Keşfet")
  buttonLink     String
  icon           String?
  gradientFrom   String?
  gradientTo     String?
  desktopColSpan Int      @default(1)
  desktopRowSpan Int      @default(1)
  mobileColSpan  Int      @default(1)
  mobileRowSpan  Int      @default(1)
  order          Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  desktopImage   String?
  isActive       Boolean  @default(true)
  mobileImage    String?
  banner         Banner   @relation(fields: [bannerId], references: [id], onDelete: Cascade)

  @@map("banner_cards")
}

model Slider {
  id                      String       @id @default(cuid())
  name                    String
  badge                   String?
  badgeIcon               String?
  title                   String
  titleHighlight          String?
  subtitle                String?
  buttonText              String?
  buttonLink              String?
  button2Text             String?
  button2Link             String?
  desktopImage            String?
  mobileImage             String?
  backgroundVideo         String?
  overlayColor            String?
  order                   Int          @default(0)
  isActive                Boolean      @default(true)
  showOnMobile            Boolean      @default(true)
  showOnDesktop           Boolean      @default(true)
  startDate               DateTime?
  endDate                 DateTime?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
  buttonStyle             ButtonStyle  @default(PRIMARY)
  button2Style            ButtonStyle  @default(SECONDARY)
  textAlign               TextAlign    @default(LEFT)
  theme                   SliderTheme  @default(DARK)
  animation               String?
  animationDelay          Int          @default(0)
  autoplay                Boolean      @default(true)
  autoplayDelay           Int          @default(5000)
  effect                  SliderEffect @default(FADE)
  effectSpeed             Int          @default(500)
  gradientFrom            String?
  gradientTo              String?
  loop                    Boolean      @default(true)
  overlayOpacity          Int          @default(50)
  badgeBgColor            String?
  badgeBgColorLight       String?
  badgeTextColor          String?
  badgeTextColorLight     String?
  button2BgColor          String?
  button2BgColorLight     String?
  button2TextColor        String?
  button2TextColorLight   String?
  buttonBgColor           String?
  buttonBgColorLight      String?
  buttonTextColor         String?
  buttonTextColorLight    String?
  overlayColorLight       String?
  overlayOpacityLight     Int?
  subtitleColor           String?
  subtitleColorLight      String?
  titleColor              String?
  titleColorLight         String?
  titleHighlightFrom      String?
  titleHighlightFromLight String?
  titleHighlightTo        String?
  titleHighlightToLight   String?

  @@map("sliders")
}

model Media {
  id          String        @id @default(cuid())
  filename    String
  key         String        @unique
  url         String
  mimeType    String
  size        Int
  width       Int?
  height      Int?
  alt         String?
  uploadedBy  String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  description String?
  ownerUserId String?
  provider    MediaProvider @default(S3)
  title       String?
  usage       MediaUsage    @default(OTHER)
  folder      MediaFolder   @default(GENERAL)

  @@map("media")
}

model MysteryBoxClaim {
  id          String   @id @default(cuid())
  userId      String?
  fingerprint String
  couponId    String
  couponCode  String
  claimedAt   DateTime @default(now())
  expiresAt   DateTime
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([fingerprint])
  @@index([userId])
  @@index([expiresAt])
  @@map("mystery_box_claims")
}

model FeatureDefinition {
  id            String                @id @default(cuid())
  name          String                @unique
  slug          String                @unique
  inputType     FeatureInputType      @default(TEXT)
  unit          String?
  description   String?
  placeholder   String?
  isActive      Boolean               @default(true)
  order         Int                   @default(0)
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  categories    CategoryFeature[]
  presetValues  FeaturePresetValue[]
  productValues ProductFeatureValue[]

  @@map("feature_definitions")
}

model CategoryFeature {
  id         String            @id @default(cuid())
  categoryId String
  featureId  String
  sortOrder  Int               @default(0)
  isRequired Boolean           @default(false)
  isDefault  Boolean           @default(false)
  createdAt  DateTime          @default(now())
  category   Category          @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  feature    FeatureDefinition @relation(fields: [featureId], references: [id], onDelete: Cascade)

  @@unique([categoryId, featureId])
  @@map("category_features")
}

model FeaturePresetValue {
  id        String            @id @default(cuid())
  featureId String
  value     String
  label     String?
  order     Int               @default(0)
  createdAt DateTime          @default(now())
  feature   FeatureDefinition @relation(fields: [featureId], references: [id], onDelete: Cascade)

  @@unique([featureId, value])
  @@map("feature_preset_values")
}

model ProductFeatureValue {
  id           String            @id @default(cuid())
  productId    String
  featureId    String
  valueText    String?
  valueNumber  Decimal?          @db.Decimal(10, 2)
  unit         String?
  displayOrder Int               @default(0)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  feature      FeatureDefinition @relation(fields: [featureId], references: [id], onDelete: Cascade)
  product      Product           @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, featureId])
  @@map("product_feature_values")
}

model ShippingClass {
  id          String                    @id @default(cuid())
  name        String                    @unique
  slug        String                    @unique
  description String?
  alwaysFree  Boolean                   @default(false)
  priority    Int                       @default(0)
  isActive    Boolean                   @default(true)
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt
  cost        Decimal                   @default(0) @db.Decimal(10, 2)
  products    Product[]                 @relation("ProductShippingClass")
  methodCosts ShippingMethodClassCost[]

  @@map("shipping_classes")
}

model ShippingZone {
  id          String               @id @default(cuid())
  name        String
  regions     Json?
  postalCodes Json?
  order       Int                  @default(0)
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  methods     ShippingZoneMethod[]

  @@map("shipping_zones")
}

model ShippingMethod {
  id                      String                  @id @default(cuid())
  name                    String
  type                    ShippingMethodType      @default(FLAT_RATE)
  description             String?
  cost                    Decimal                 @default(0) @db.Decimal(10, 2)
  freeShippingRequirement FreeShippingRequirement @default(NONE)
  minOrderAmount          Decimal?                @db.Decimal(10, 2)
  taxStatus               TaxStatus               @default(TAXABLE)
  order                   Int                     @default(0)
  isEnabled               Boolean                 @default(true)
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @updatedAt
  zones                   ShippingZoneMethod[]

  @@map("shipping_methods")
}

model ShippingZoneMethod {
  id           String                    @id @default(cuid())
  zoneId       String
  methodId     String
  costOverride Decimal?                  @db.Decimal(10, 2)
  order        Int                       @default(0)
  isEnabled    Boolean                   @default(true)
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  classCosts   ShippingMethodClassCost[]
  method       ShippingMethod            @relation(fields: [methodId], references: [id], onDelete: Cascade)
  zone         ShippingZone              @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  @@unique([zoneId, methodId])
  @@map("shipping_zone_methods")
}

model ShippingMethodClassCost {
  id              String             @id @default(cuid())
  zoneMethodId    String
  shippingClassId String
  additionalCost  Decimal            @default(0) @db.Decimal(10, 2)
  createdAt       DateTime           @default(now())
  shippingClass   ShippingClass      @relation(fields: [shippingClassId], references: [id], onDelete: Cascade)
  zoneMethod      ShippingZoneMethod @relation(fields: [zoneMethodId], references: [id], onDelete: Cascade)

  @@unique([zoneMethodId, shippingClassId])
  @@map("shipping_method_class_costs")
}

model ShippingSettings {
  id                     String   @id @default("default")
  freeShippingLimit      Decimal  @default(2000) @db.Decimal(10, 2)
  heavyClassFreeLimit    Decimal  @default(0) @db.Decimal(10, 2)
  taxRate                Decimal  @default(20) @db.Decimal(5, 2)
  defaultShippingClassId String?
  enableShippingCalc     Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  @@map("shipping_settings")
}

model BlogPost {
  id              String         @id @default(cuid())
  slug            String         @unique
  title           String
  content         String
  excerpt         String?
  featuredImage   String?
  category        String?
  tags            String[]
  metaTitle       String?
  metaDescription String?
  metaKeywords    String[]
  authorId        String?
  authorName      String?        @default("FusionMarkt")
  status          BlogPostStatus @default(DRAFT)
  publishedAt     DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([status])
  @@index([publishedAt])
  @@index([category])
  @@map("blog_posts")
}

model LegalPage {
  id                String   @id @default(cuid())
  slug              String   @unique
  title             String
  content           String
  isActive          Boolean  @default(true)
  showOnCheckout    Boolean  @default(false)
  requireAcceptance Boolean  @default(false)
  sortOrder         Int      @default(0)
  metaTitle         String?
  metaDescription   String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([slug])
  @@index([isActive])
  @@index([showOnCheckout])
  @@map("legal_pages")
}

model EmailLog {
  id           String      @id @default(cuid())
  resendId     String      @unique
  to           String
  subject      String
  type         EmailType   @default(OTHER)
  status       EmailStatus @default(SENT)
  orderId      String?
  userId       String?
  sentAt       DateTime    @default(now())
  deliveredAt  DateTime?
  openedAt     DateTime?
  clickedAt    DateTime?
  bouncedAt    DateTime?
  complainedAt DateTime?
  errorMessage String?
  metadata     Json?       @db.Json
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@index([to])
  @@index([type])
  @@index([status])
  @@index([sentAt])
  @@index([orderId])
  @@index([userId])
  @@map("email_logs")
}

model ContactMessage {
  id         String               @id @default(cuid())
  name       String
  email      String
  phone      String?
  subject    String?
  message    String
  status     ContactMessageStatus @default(UNREAD)
  ipAddress  String?
  userAgent  String?
  adminReply String?
  repliedAt  DateTime?
  repliedBy  String?
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt

  @@index([status])
  @@index([email])
  @@index([createdAt])
  @@map("contact_messages")
}

model SiteSettings {
  id                       String   @id @default("default")
  siteTitle                String   @default("FusionMarkt - Güç İstasyonları ve Solar Paneller")
  siteDescription          String   @default("Türkiye'nin en kapsamlı taşınabilir güç çözümleri mağazası.")
  keywords                 String   @default("güç istasyonu, solar panel, taşınabilir enerji")
  ogImage                  String?
  twitterHandle            String?
  googleAnalyticsId        String?
  googleTagManagerId       String?
  facebookPixelId          String?
  gaPropertyId             String?
  gaServiceAccountEmail    String?
  gaServiceAccountKey      String?
  robotsTxt                String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  gscServiceAccountEmail   String?
  gscServiceAccountKey     String?
  gscSiteUrl               String?
  cookieBannerEnabled      Boolean  @default(true)
  cookieBannerPosition     String   @default("bottom")
  cookieBannerText         String   @default("Bu web sitesi deneyiminizi geliştirmek için çerezler kullanmaktadır.")
  cookieDefaultAnalytics   Boolean  @default(true)
  cookieDefaultMarketing   Boolean  @default(false)
  cookieDefaultPreferences Boolean  @default(true)
  // İade Ayarları
  defaultReturnAddress     String?  // Varsayılan iade depo adresi
  returnShippingInfo       String   @default("Kargo ücreti alıcı ödemeli olarak gönderilmelidir.")

  @@map("site_settings")
}

model FaqCategory {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  icon        String?
  color       String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  faqs        Faq[]

  @@map("faq_categories")
}

model Faq {
  id         String      @id @default(cuid())
  question   String
  answer     String
  categoryId String
  order      Int         @default(0)
  isActive   Boolean     @default(true)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  category   FaqCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([isActive])
  @@index([order])
  @@map("faqs")
}

model Bundle {
  id               String            @id @default(cuid())
  name             String
  slug             String            @unique
  description      String?
  shortDescription String?
  pricingType      BundlePricingType @default(FIXED)
  price            Decimal           @db.Decimal(10, 2)
  comparePrice     Decimal?          @db.Decimal(10, 2)
  thumbnail        String?
  images           String[]
  videoUrl         String?
  brand            String?
  sku              String?           @unique
  metaTitle        String?
  metaDescription  String?
  metaKeywords     String[]
  isActive         Boolean           @default(true)
  isFeatured       Boolean           @default(false)
  publishedAt      DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  brandId          String?
  bundleBadges     BundleBadge[]
  categories       BundleCategory[]
  items            BundleItem[]
  reviews          Review[]          // Bundle yorumları
  brandRef         Brand?            @relation(fields: [brandId], references: [id])
  cartItems        CartItem[]
  orderItems       OrderItem[]

  @@index([isActive])
  @@index([slug])
  @@map("bundles")
}

model BundleCategory {
  id         String   @id @default(cuid())
  bundleId   String
  categoryId String
  isPrimary  Boolean  @default(false)
  sortOrder  Int      @default(0)
  createdAt  DateTime @default(now())
  bundle     Bundle   @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([bundleId, categoryId])
  @@index([bundleId])
  @@index([categoryId])
  @@map("bundle_categories")
}

model BundleItem {
  id        String   @id @default(cuid())
  bundleId  String
  productId String
  variantId String?
  quantity  Int      @default(1)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  bundle    Bundle   @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([bundleId, productId, variantId])
  @@index([bundleId])
  @@index([productId])
  @@map("bundle_items")
}

enum UserRole {
  CUSTOMER
  ADMIN
  SUPER_ADMIN
}

enum ProductType {
  SIMPLE
  VARIABLE
  GROUPED
  DIGITAL
}

enum AttributeType {
  SELECT
  MULTI_SELECT
  COLOR
  IMAGE
  TEXT
  NUMBER
  BOOLEAN
}

enum AttributeDisplay {
  DROPDOWN
  BUTTONS
  COLOR_SWATCH
  IMAGE_SWATCH
}

enum RelationType {
  FREQUENTLY_BOUGHT
  ALSO_VIEWED
  UPSELL
  CROSS_SELL
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum AddressType {
  SHIPPING
  BILLING
  BOTH
}

enum DiscountType {
  PERCENTAGE
  FIXED
}

enum FilterSource {
  ATTRIBUTE
  CATEGORY
  TAG
  BRAND
  PRICE
  STOCK
  RATING
  CUSTOM
}

enum FilterType {
  CHECKBOX
  RADIO
  COLOR_SWATCH
  IMAGE_SWATCH
  RANGE
  DROPDOWN
  LABEL
}

enum FilterDisplay {
  LIST
  INLINE
  GRID
  DROPDOWN
}

enum HierarchyType {
  FLAT
  PARENT_ONLY
  FULL
}

enum BannerType {
  SINGLE
  GRID
  CAROUSEL
  HERO
  CATEGORY
  CATEGORY_GRID
}

enum BannerPlacement {
  HOME_HERO
  HOME_CATEGORY
  HOME_PROMO
  HOME_BOTTOM
  CATEGORY_TOP
  CATEGORY_BOTTOM
  PRODUCT_RELATED
  CHECKOUT
  CUSTOM
  SHOP_HEADER
  SHOP_CATEGORY_ENDUSTRIYEL_ELDIVENLER
  SHOP_CATEGORY_TELESKOPIK_MERDIVENLER
  SHOP_CATEGORY_TASINABILIR_GUC_KAYNAKLARI
  SHOP_CATEGORY_GUNES_PANELLERI
}

enum ButtonStyle {
  PRIMARY
  SECONDARY
  OUTLINE
  GHOST
  LINK
}

enum TextAlign {
  LEFT
  CENTER
  RIGHT
}

enum SliderTheme {
  DARK
  LIGHT
  GRADIENT
  CUSTOM
}

enum SliderEffect {
  NONE
  FADE
  SLIDE
  PARALLAX
  ZOOM
  CUBE
}

enum MediaProvider {
  LOCAL
  S3
}

enum MediaFolder {
  PRODUCTS
  BANNERS
  SLIDERS
  CATEGORIES
  USERS
  GENERAL
}

enum MediaUsage {
  USER_PHOTO
  BANNER
  SLIDER
  PRODUCT
  CATEGORY
  OTHER
}

enum FeatureInputType {
  TEXT
  NUMBER
  SELECT
}

enum ShippingMethodType {
  FREE_SHIPPING
  FLAT_RATE
  LOCAL_PICKUP
}

enum FreeShippingRequirement {
  NONE
  MIN_AMOUNT
  COUPON
  MIN_OR_COUPON
  MIN_AND_COUPON
}

enum TaxStatus {
  TAXABLE
  NONE
}

enum BlogPostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum EmailType {
  ORDER_CONFIRMATION
  ORDER_STATUS
  ORDER_SHIPPED
  ORDER_DELIVERED
  ORDER_CANCELLED
  ORDER_REFUNDED
  INVOICE
  PAYMENT_CONFIRMED
  WELCOME
  PASSWORD_RESET
  ABANDONED_CART
  MARKETING
  OTHER
  REVIEW_REMINDER
  CANCELLATION_REQUEST
  CANCELLATION_APPROVED
  CANCELLATION_REJECTED
  RETURN_REQUEST
  RETURN_APPROVED
  RETURN_REJECTED
}

enum EmailStatus {
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  COMPLAINED
  FAILED
}

enum ContactMessageStatus {
  UNREAD
  READ
  REPLIED
  SPAM
  ARCHIVED
}

enum BundlePricingType {
  FIXED
  SUM
  SUM_DISCOUNT
}

// ═══════════════════════════════════════════════════════════════════════════
// CANCELLATION & RETURN REQUEST ENUMS
// ═══════════════════════════════════════════════════════════════════════════

enum RequestStatus {
  PENDING_ADMIN_APPROVAL
  APPROVED
  REJECTED
}

enum ReturnReason {
  DAMAGED
  WRONG_PRODUCT
  SPECS_MISMATCH
}

enum BanType {
  SOFT
  HARD
}
